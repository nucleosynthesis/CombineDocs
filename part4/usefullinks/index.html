<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="shortcut icon" href="../../img/favicon.ico">

    
    <title>Part4 - Combine Documentation</title>
    

    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/3.003/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../css/base.min.css" rel="stylesheet">
    <link href="../../css/cinder.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.min.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.28/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../..">Combine Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../part1/gettingstarted/">Part1</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Part2 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../part2/settinguptheanalysis/">Setting up the analysis</a>
</li>

                        
                            
<li >
    <a href="../../part2/physicsmodels/">Physics models</a>
</li>

                        
                            
<li >
    <a href="../../part2/bin-wise-stats/">Automatic MC statistical uncertainties</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Part3 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../part3/runningthetool/">Running the tool</a>
</li>

                        
                            
<li >
    <a href="../../part3/commonstatsmethods/">Common statistical methods</a>
</li>

                        
                            
<li >
    <a href="../../part3/nonstandard/">Advanced use cases</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Part4</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../../part3/nonstandard/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li class="disabled">
                        <a rel="prev" >
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit/edit/master/doc/docs/part4/usefullinks.md"><i class="fab fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#useful-links-and-further-reading">Useful links and further reading</a></li>
            <li class="second-level"><a href="#tutorials-and-reading-material">Tutorials and reading material</a></li>
                
            <li class="second-level"><a href="#citations">Citations</a></li>
                
            <li class="second-level"><a href="#combine-based-packages">Combine based packages</a></li>
                
            <li class="second-level"><a href="#contacts">Contacts</a></li>
                
            <li class="second-level"><a href="#cms-statistics-committee">CMS Statistics Committee</a></li>
                
        <li class="first-level "><a href="#faq">FAQ</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="useful-links-and-further-reading">Useful links and further reading</h1>
<h3 id="tutorials-and-reading-material">Tutorials and reading material</h3>
<p>There are several tutorials which have been run over the last few years with instructions and examples for running the combine tool.</p>
<ul>
<li>
<p>Tutorial Sessions</p>
</li>
<li>
<p><a href="https://indico.cern.ch/event/456547/">1st tutorial 17th Nov 2015</a>.</p>
</li>
<li><a href="https://indico.cern.ch/event/577649/#b-229590-higgs-combine-tool-mi">2nd tutorial 30th Nov 2016</a>.</li>
<li><a href="https://indico.cern.ch/event/677948/#day-2017-11-29">3rd tutorial 29th Nov 2017</a> </li>
<li>
<p><a href="https://indico.cern.ch/event/747340/overview">4th tutorial 31st Oct 2018</a> - Latest for <code>81x-root606</code> branch.</p>
</li>
<li>
<p>Worked examples from Higgs analyses using combine </p>
</li>
<li><a href="https://twiki.cern.ch/twiki/bin/viewauth/CMS/SWGuideCMSDataAnalysisSchool2014HiggsCombPropertiesExercise">The CMS DAS at CERN 2014</a></li>
<li>
<p><a href="SWGuideCMSDataAnalysisSchoolHamburg2018LongStatisticsExercise">The CMS DAS at DESY 2018</a></p>
</li>
<li>
<p><a href="https://twiki.cern.ch/twiki/bin/view/CMS/HiggsWG/HiggsCombinationConventions">Conventions to be used when preparing inputs for Higgs combinations</a></p>
</li>
<li>
<p><a href="http://cms.cern.ch/iCMS/jsp/db_notes/noteInfo.jsp?cmsnoteid=CMS AN-2011/298">CMS AN-2011/298</a> Procedure for the LHC Higgs boson search combination in summer 2011. This describes in more detail some of the methods used in Combine.</p>
</li>
</ul>
<h3 id="citations">Citations</h3>
<p>There is no document currently which can be cited for using the combine tool, however you can use the following publications for the procedures we use,</p>
<ul>
<li>
<p><a href="https://cds.cern.ch/record/1379837">Summer 2011 public ATLAS-CMS note</a> for any Frequentist limit setting procedures with toys or Bayesian limits, constructing likelihoods, descriptions of nuisance parameter options (like log-normals (<code>lnN</code>) or gamma (<code>gmN</code>), and for definitions of test-statistics.</p>
</li>
<li>
<p><a href="https://arxiv.org/abs/1007.1727">CCGV paper</a> if you use any of the <strong>asymptotic</strong> (eg with <code>-M AsymptoticLimits</code> or <code>-M Significance</code> approximations for limits/p-values.</p>
</li>
<li>
<p>If you use the Barlow-Beeston approach to MC stat (bin-by-bin) uncertainties, please cite their paper <a href="https://www.sciencedirect.com/science/article/pii/001046559390005W?via%3Dihub">Barlow-Beeston</a>. You should also cite <a href="https://arxiv.org/pdf/1103.0354.pdf">this note</a> if you use the <code>autoMCStats</code> directive to produce a single parameter per bin.</p>
</li>
<li>
<p>If you use <code>shape</code> uncertainties for template (<code>TH1</code> or <code>RooDataHist</code>) based datacards, you can cite <a href="https://arxiv.org/pdf/1103.0354.pdf">this note</a> from J. Conway.</p>
</li>
<li>
<p>If you are extracting uncertainties from LH scans - i.e using <span><span class="MathJax_Preview">-2\Delta Log{L}=1</span><script type="math/tex">-2\Delta Log{L}=1</script></span> etc for the 1<span><span class="MathJax_Preview">\sigma</span><script type="math/tex">\sigma</script></span> intervals, you can cite either the <a href="https://arxiv.org/abs/1606.02266">ATLAS+CMS</a> or <a href="https://link.springer.com/article/10.1140/epjc/s10052-015-3351-7">CMS</a> Higgs paper.</p>
</li>
<li>
<p>There is also a long list of citation recommendations from the <a href="https://twiki.cern.ch/twiki/bin/view/CMS/StatisticsReferences">CMS Statistics Committee</a> pages.</p>
</li>
</ul>
<h3 id="combine-based-packages">Combine based packages</h3>
<ul>
<li>
<p><a href="https://twiki.cern.ch/twiki/bin/view/CMS/SWGuideHiggs2TauLimits">SWGuideHiggs2TauLimits</a></p>
</li>
<li>
<p><a href="https://twiki.cern.ch/twiki/bin/view/CMS/ATGCRooStats">ATGCRooStats</a></p>
</li>
<li>
<p><a href="http://cms-analysis.github.io/CombineHarvester/">CombineHarvester</a></p>
</li>
</ul>
<h3 id="contacts">Contacts</h3>
<ul>
<li><strong>Hypernews forum</strong>: hn-cms-higgs-combination <a href="https://hypernews.cern.ch/HyperNews/CMS/get/higgs-combination.html">https://hypernews.cern.ch/HyperNews/CMS/get/higgs-combination.html</a></li>
</ul>
<h3 id="cms-statistics-committee">CMS Statistics Committee</h3>
<ul>
<li>You can find much more statistics theory and reccomendations on various statistical procedures in the <a href="https://twiki.cern.ch/twiki/bin/viewauth/CMS/StatisticsCommittee#Recommendations_from_the_Committ">CMS Statistics Committee Twiki Pages</a></li>
</ul>
<h1 id="faq">FAQ</h1>
<ul>
<li><em>Why does combine have trouble with bins that have zero expected contents?</em><ul>
<li>If you're computing only upper limits, and your zero-prediction bins are all empty in data, then you can just set the background to a very small value instead of zero as anyway the computation is regular for background going to zero (e.g. a counting experiment with <span><span class="MathJax_Preview">B\leq1</span><script type="math/tex">B\leq1</script></span> will have essentially the same expected limit and observed limit as one with <span><span class="MathJax_Preview">B=0</span><script type="math/tex">B=0</script></span>). If you're computing anything else, e.g. p-values, or if your zero-prediction bins are not empty in data, you're out of luck, and you should find a way to get a reasonable background prediction there (and set an uncertainty on it, as per the point above)</li>
</ul>
</li>
<li><em>How can an uncertainty be added to a zero quantity?</em><ul>
<li>You can put an uncertainty even on a zero event yield if you use a gamma distribution. That's in fact the more proper way of doing it if the prediction of zero comes from the limited size of your MC or data sample used to compute it.</li>
</ul>
</li>
<li><em>Why does changing the observation in data affect my expected limit?</em><ul>
<li>The expected limit (if using either the default behaviour of <code>-M AsymptoticLimits</code> or using the <code>LHC-limits</code> style limit setting with toys) uses the <em><strong>post-fit</strong></em> expectation of the background model to generate toys. This means that first the model is fit to the <em><strong>observed data</strong></em> before toy generation. See the sections on <a href="/part3/commonstatsmethods#blind-limits">blind limits</a> and <a href="/part3/runningthetool.html#toy-data-generation">toy generation</a> to avoid this behavior. </li>
</ul>
</li>
<li><em>How can I deal with an interference term which involves a negative contribution?</em><ul>
<li>You will need to set up a specific PhysicsModel to deal with this, however you can <a href="/part2/physicsmodels#interference">see this section</a> to implement such a model which can incorperate a negative contribution to the physics process</li>
</ul>
</li>
<li><em>How does combine work?</em><ul>
<li>That is not a question which can be answered without someone's head exploding so please try to formulate something specific.</li>
</ul>
</li>
<li><em>What does fit status XYZ mean?</em> <ul>
<li>Combine reports the fit status in some routines (for example in the <code>FitDiagnostics</code> method). These are typically the status of the last call from Minuit. For details on the meanings of these status codes see the <a href="https://root.cern.ch/root/html/ROOT__Minuit2__Minuit2Minimizer.html">Minuit2Minimizer</a> documentation page.</li>
</ul>
</li>
<li><em>Why does my fit not converge?</em> <ul>
<li>There are several reasons why some fits may not converge. Often some indication can be obtained from the <code>RooFitResult</code> or status which you will see information from when using the <code>--verbose X</code> (with <span><span class="MathJax_Preview">X&gt;2</span><script type="math/tex">X>2</script></span>) option. Sometimes however, it can be that the likelihood for your data is very unusual. You can get a rough idea about what the likelihood looks like as a function of your parameters (POIs and nuisances) using <code>combineTool.py -M FastScan -w myworkspace.root</code> (use --help for options). </li>
</ul>
</li>
<li><em>Why does the fit/fits take so long?</em> <ul>
<li>The minimisation routines are common to many methods in combine. You can tune the fitting using the generic optimisation command line options described <a href="/part3/runningthetool#generic-minimizer-options">here</a>. For example, setting the default minimizer strategy to 0 can greatly improve the speed since this avoids running Hesse. In calculations such as <code>AsymptoticLimits</code>, Hesse is not needed and hence this can be done, however, for <code>FitDiagnostics</code> the uncertainties and correlations are part of the output so using strategy 0 may not be particularly accurate. </li>
</ul>
</li>
<li><em>Why are the results for my counting experiment so slow or unstable?</em> <ul>
<li>There is a known issue with counting experiments with <strong><em>large</em></strong> numbers of events which will cause unstable fits or even the fit to fail. You can avoid this by creating a "fake" shape datacard (see <a href="/part2/settinguptheanalysis.mf#combination-of-multiple-datacards">this section</a> from the setting up the datacards page). The simplest way to do this is to run <code>combineCards.py -S mycountingcard.txt &gt; myshapecard.txt</code>. You may still find that your parameter uncertainties are not correct when you have large numbers of events. This can be often fixed using the <code>--robustHesse</code> option. An example of this issue is detailed <a href="https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit/issues/498">here</a>. </li>
</ul>
</li>
<li><em>Why do some of my nuisance parameters have uncertainties &gt; 1?</em><ul>
<li>When running <code>-M FitDiagnostics</code> you may find that the post-fit uncertainties of the nuisances are <span><span class="MathJax_Preview">&gt; 1</span><script type="math/tex">> 1</script></span> (or larger than their pre-fit values). If this is the case, you should first check if the same is true when adding the option <code>--minos all</code> which will invoke minos to scan the likelihood as a function of these parameters to determine the crossing at <span><span class="MathJax_Preview">-2\times\Delta\log\mathcal{L}=1</span><script type="math/tex">-2\times\Delta\log\mathcal{L}=1</script></span> rather than relying on the estimate from Hesse. However, this is not guaranteed to succeed, in which case you can scan the likelihood yourself using <code>MultiDimFit</code> (see <a href="/part3/commonstatsmethods#likelihood-fits-and-scans">here</a> ) and specifying the option <code>--poi X</code> where <code>X</code> is your nuisance parameter. </li>
</ul>
</li>
<li><em>How can I avoid using the data?</em> <ul>
<li>For almost all methods, you can use toy data (or an Asimov dataset) in place of the real data for your results to be blind. You should be careful however as in some methods, such as <code>-M AsymptoticLimits</code> or <code>-M HybridNew --LHCmode LHC-limits</code> or any other method using the option <code>--toysFrequentist</code>, the data will be used to determine the most likely nuisance parameter values (to determine the so-called a-posteriori expectation). See the section on <a href="/part3/runningthetool#toy-data-generation">toy data generation</a> for details on this. </li>
</ul>
</li>
<li><em>What if my nuisance parameters have correlations which are not 0 or 1?</em><ul>
<li>Combine is designed under the assumption that each <em>source</em> of nuisance parameter is uncorrelated with the other sources. If you have a case where some pair (or set) of nuisances have some known correlation structure, you can compute the eigenvectors of their correlation matrix and provide these <em>diagonalised</em> nuisances to combine. You can also model <em>partial correlations</em>, between different channels or data taking periods, of a given nuisance parameter using the <code>combineTool</code> as described in <a href="https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit/issues/503">this page</a>. </li>
</ul>
</li>
</ul></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
        
        
        
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <!-- <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script> -->
    <script src="../../js/base.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script src="../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
